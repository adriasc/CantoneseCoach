<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
  <title>Cantonese Coach</title>
  <meta name="theme-color" content="#112d4e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="CanCoach">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="bg-shape shape-a"></div>
  <div class="bg-shape shape-b"></div>

  <main class="app-shell">
    <header class="topbar">
      <div>
        <p class="eyebrow">Daily Cantonese <span class="version-tag">v19.4.56</span></p>
        <h1 id="appTitle">Cantonese Coach</h1>
      </div>
      <div class="topbar-right">
        <div class="streak" id="streakBadge">ğŸ”¥ 0th-Day</div>
        <button id="openSettings" class="gear-btn" type="button" aria-label="Open audio and display settings"><span class="gear-lines" aria-hidden="true"></span></button>
      </div>
    </header>

    <nav class="tabs">
      <button class="tab is-active" data-tab="words">
        <span class="learn-tab-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" role="img" focusable="false" aria-hidden="true">
            <path d="M5 6.5h6.5v11H5z"></path>
            <path d="M12.5 6.5H19v11h-6.5"></path>
            <path d="M11.5 8H7.2"></path>
            <path d="M16.8 8h-3.6"></path>
          </svg>
        </span>
        <span class="learn-tab-label">Learn Words</span>
      </button>
      <button class="tab" data-tab="tones">
        <span class="learn-tab-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" role="img" focusable="false" aria-hidden="true">
            <path d="M4.5 15.5a4.5 4.5 0 0 1 0-7"></path>
            <path d="M8 18.5a8.5 8.5 0 0 1 0-13"></path>
            <path d="M11.5 21a12 12 0 0 1 0-18"></path>
            <path d="M17 7.5a2.3 2.3 0 1 1-2.3 2.3V7.5z"></path>
          </svg>
        </span>
        <span class="learn-tab-label">Tone Drill</span>
      </button>
      <button class="tab" data-tab="patterns">
        <span class="learn-tab-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" role="img" focusable="false" aria-hidden="true">
            <rect x="3.5" y="4.5" width="7" height="5" rx="1"></rect>
            <rect x="13.5" y="4.5" width="7" height="5" rx="1"></rect>
            <rect x="8.5" y="14.5" width="7" height="5" rx="1"></rect>
            <path d="M10.5 7h3"></path>
            <path d="M12 9.5v5"></path>
          </svg>
        </span>
        <span class="learn-tab-label">Build Sentences</span>
      </button>
      <button class="tab" data-tab="questions">
        <span class="learn-tab-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" role="img" focusable="false" aria-hidden="true">
            <path d="M4.5 6.5h9a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2H9l-3.5 3v-3H4.5a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2z"></path>
            <path d="M13.5 9.5h6a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2H16l-2.5 2v-2h0"></path>
          </svg>
        </span>
        <span class="learn-tab-label">Ask &amp; Answer</span>
      </button>
      <button class="tab" data-tab="listening">
        <span class="learn-tab-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" role="img" focusable="false" aria-hidden="true">
            <path d="M6.5 12a5.5 5.5 0 0 1 11 0"></path>
            <rect x="4" y="11" width="3.5" height="6.5" rx="1.2"></rect>
            <rect x="16.5" y="11" width="3.5" height="6.5" rx="1.2"></rect>
            <path d="M12 18.5v2"></path>
            <path d="M9.5 21h5"></path>
          </svg>
        </span>
        <span class="learn-tab-label">Listen &amp; Choose</span>
      </button>
      <button class="tab" data-tab="exercises">
        <span class="learn-tab-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" role="img" focusable="false" aria-hidden="true">
            <rect x="4.5" y="5" width="15" height="15" rx="2"></rect>
            <path d="M8 9h8"></path>
            <path d="M8 13h5"></path>
            <path d="m14.5 15.5 1.5 1.5 3-3"></path>
          </svg>
        </span>
        <span class="learn-tab-label">Translate</span>
      </button>
    </nav>

    <nav class="stories-top-tabs" aria-label="Stories sections">
      <button class="tab stories-nav-btn is-active" type="button" data-story-tab="dialogs">Mini Stories</button>
      <button class="tab stories-nav-btn" type="button" data-story-tab="culture">Street Culture</button>
      <button class="tab stories-nav-btn" type="button" data-story-tab="curiosities">Curiosities</button>
      <button class="tab stories-nav-btn" type="button" data-story-tab="facts">Fun Facts</button>
      <button class="tab stories-nav-btn" type="button" data-story-tab="fun">Fun Loop</button>
    </nav>

    <nav class="book-top-tabs" aria-label="Book sections">
      <button class="tab book-nav-btn is-active" type="button" data-book-tab="grammar">Grammar</button>
      <button class="tab book-nav-btn" type="button" data-book-tab="tones">Tones</button>
      <button class="tab book-nav-btn" type="button" data-book-tab="writing">Writing</button>
      <button class="tab book-nav-btn" type="button" data-book-tab="culture">Culture</button>
    </nav>

    <section class="card controls-card">
      <div class="card-head">
        <h2>Practice Controls</h2>
        <button id="toggleControlsCard" class="ghost-btn" type="button" aria-label="Collapse or expand practice controls">âŒ„</button>
      </div>
      <div class="slot-grid controls-grid">
        <div id="globalLevelWrap" class="general-control">
          <label for="globalLevel">Level</label>
          <select id="globalLevel">
            <option value="1">Level 1 - short</option>
            <option value="2">Level 2 - medium</option>
            <option value="3">Level 3 - advanced</option>
            <option value="4">Level 4 - long/conditional</option>
            <option value="mixed">Mixed levels</option>
          </select>
        </div>
        <div id="globalTenseWrap" class="general-control">
          <label for="globalTense">Verb Time</label>
          <select id="globalTense">
            <option value="mixed">Mixed</option>
            <option value="present">Present</option>
            <option value="past">Past</option>
            <option value="future">Future</option>
            <option value="conditional">Conditional</option>
          </select>
        </div>
        <div id="wordFilterWrap" class="general-control hidden">
          <label for="wordFilter">Word Filter</label>
          <select id="wordFilter">
            <option value="mixed">Mixed (all words)</option>
            <option value="pronouns">Pronouns</option>
            <option value="verbs">Verbs</option>
            <option value="nouns">Nouns</option>
            <option value="adjectives">Adjectives</option>
            <option value="adverbs">Adverbs</option>
            <option value="time">Time words</option>
            <option value="places">Places</option>
            <option value="numbers">Numbers</option>
            <option value="grammar">Grammar words</option>
            <option value="prepositions">Prepositions</option>
            <option value="conjunctions">Conjunctions</option>
            <option value="measure_words">Measure words</option>
            <option value="particles">Particles</option>
            <option value="aspect_markers">Aspect markers</option>
            <option value="past_markers">Past markers only</option>
            <option value="present_markers">Present markers only</option>
            <option value="future_markers">Future markers only</option>
            <option value="conditional_markers">Conditional markers only</option>
          </select>
        </div>
        <div id="globalThemeWrap" class="general-control">
          <label for="globalTheme">Theme</label>
          <select id="globalTheme">
            <option value="mixed">Mixed</option>
            <option value="home">Home/Family</option>
            <option value="friends">Friends</option>
            <option value="travel">Travel/Going out</option>
            <option value="daily">Daily routines</option>
            <option value="holiday">Holiday plans</option>
          </select>
        </div>
        <div id="questionLevelWrap" class="question-control hidden">
          <label for="questionLevel">Question Level</label>
          <select id="questionLevel">
            <option value="basic">Basic Questions</option>
            <option value="advanced">Advanced Questions</option>
          </select>
        </div>
        <div id="questionTenseWrap" class="question-control hidden">
          <label for="questionTense">Verb Time</label>
          <select id="questionTense">
            <option value="mixed">Mixed</option>
            <option value="present">Present</option>
            <option value="past">Past</option>
            <option value="future">Future</option>
            <option value="conditional">Conditional</option>
          </select>
        </div>
        <div id="questionThemeWrap" class="question-control hidden">
          <label for="questionTheme">Question Type</label>
          <select id="questionTheme">
            <option value="mixed">Mixed</option>
            <option value="who">Who</option>
            <option value="where">Where</option>
            <option value="when">When</option>
            <option value="how">How</option>
            <option value="how_much">How much / How many</option>
            <option value="which">Which</option>
            <option value="what">What</option>
            <option value="why">Why</option>
            <option value="yes_no">Yes / No</option>
          </select>
        </div>
        <div id="toneModeWrap" class="general-control hidden">
          <label for="toneExerciseMode">Tone Exercise</label>
          <select id="toneExerciseMode">
            <option value="word">Word pairs</option>
            <option value="sentence">Sentence pairs (L3+)</option>
          </select>
        </div>
      </div>
      <div class="actions">
        <button id="applyControls">Apply Settings</button>
      </div>
      <p class="example" id="controlsMessage"></p>
    </section>

    <div class="modal hidden" id="settingsModal">
      <div class="modal-card">
        <div class="card-head">
          <h2>Audio & Display</h2>
          <button id="closeSettings" class="ghost-btn" type="button">âœ•</button>
        </div>
        <div class="slot-grid">
          <div>
            <label for="languageMode">Language Mode</label>
            <select id="languageMode">
              <option value="cantonese">Cantonese (Hanzi + Jyutping)</option>
              <option value="mandarin">Mandarin (Simplified + Pinyin)</option>
              <option value="compare">Compare (Cantonese + Mandarin)</option>
            </select>
          </div>
          <div>
            <label for="themeStyle">Theme Style</label>
            <select id="themeStyle">
              <option value="classic">Classic Pastel</option>
              <option value="harbour">HK Harbour Pastel</option>
              <option value="neon">HK Neon Soft</option>
              <option value="neon-strong">HK Neon Strong</option>
              <option value="neon-extreme">HK Neon Extreme</option>
              <option value="ink">Ink Newspaper</option>
              <option value="poster">HK Poster Pop</option>
            </select>
          </div>
          <div>
            <label for="audioVoice">Audio Voice</label>
            <select id="audioVoice">
              <option value="auto">Auto (best Cantonese)</option>
            </select>
          </div>
          <div>
            <label for="audioRate">Audio Speed (<span id="audioRateValue">0.90x</span>)</label>
            <input id="audioRate" type="range" min="0.6" max="1.2" step="0.05" value="0.9">
          </div>
          <div>
            <label for="audioNoiseType">Noise Type</label>
            <select id="audioNoiseType">
              <option value="white">White noise</option>
              <option value="street">Street</option>
              <option value="radio">Radio</option>
              <option value="people">People talking</option>
              <option value="real-market">Real wet market (beta)</option>
              <option value="real-radio">Real radio chatter (beta)</option>
            </select>
          </div>
          <div>
            <label for="audioNoiseOn">Voice Noise</label>
            <select id="audioNoiseOn">
              <option value="off">Off</option>
              <option value="on">On</option>
            </select>
          </div>
          <div class="settings-noise-test-row">
            <div class="settings-noise-level">
              <label for="audioNoiseLevel">Noise Level (<span id="audioNoiseValue">0.25</span>)</label>
              <input id="audioNoiseLevel" type="range" min="0.05" max="0.80" step="0.01" value="0.25">
            </div>
            <button id="testVoice" class="play-icon-btn" aria-label="Test voice playback">â–¶</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal hidden" id="funModal">
      <div class="modal-card">
        <div class="card-head">
          <h2>Fun Loop</h2>
          <button id="closeFunLoop" class="ghost-btn" type="button">âœ•</button>
        </div>
        <p class="example">Daily mission (resets every day). XP = points. Combo = correct answers in a row. Mistakes = saved wrong items.</p>
        <div class="mini-stats">
          <p id="xpLine">XP: 0 Â· Level 1</p>
          <p id="comboLine">Combo: x0</p>
          <p id="mistakeCount">Mistakes: 0</p>
        </div>
        <div class="mission-grid">
          <p id="missionListens">Listen: 0 / 10</p>
          <p id="missionTones">Tone wins: 0 / 5</p>
          <p id="missionPatterns">Sentence drills: 0 / 3</p>
          <p id="missionHanzi">Hanzi tests: 0 / 3</p>
        </div>
        <p class="goal-line" id="missionGoal">Goal today: complete all 4 targets, then pass Boss (4/5).</p>
        <div class="actions">
          <button id="toggleFixMode">Fix Mistakes: Off</button>
          <button id="startBoss">Start Boss Challenge</button>
        </div>
        <p class="feedback" id="funFeedback"></p>
        <div class="boss-wrap hidden" id="bossWrap">
          <p class="formula" id="bossProgress">Boss 1/5</p>
          <p id="bossPrompt"></p>
          <div class="choices" id="bossChoices"></div>
          <div class="actions">
            <button id="bossPlayAudio" class="play-icon-btn" aria-label="Play challenge audio">â–¶</button>
            <button id="bossSkip">Skip</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal hidden" id="grammarModal">
      <div class="modal-card grammar-modal-card">
        <div class="card-head">
          <h2 id="grammarModalTitle">Grammar Info</h2>
          <button id="closeGrammarModal" class="ghost-btn" type="button">âœ•</button>
        </div>
        <div id="grammarModalBody" class="grammar-modal-body"></div>
      </div>
    </div>

    <div class="modal hidden" id="infoModal">
      <div class="modal-card info-modal-card">
        <div class="card-head">
          <h2 id="infoModalTitle">Info</h2>
          <button id="closeInfoModal" class="ghost-btn" type="button">âœ•</button>
        </div>
        <div id="infoModalBody" class="grammar-modal-body"></div>
      </div>
    </div>

    <section class="panel is-active" id="panel-words">
      <div class="card" id="wordCard">
        <p class="chip" id="wordCategory">Category</p>
        <h2 class="hanzi" id="wordHanzi">æˆ‘</h2>
        <p class="jyutping" id="wordJyutping">ngo5</p>
        <p class="english" id="wordEnglish">I / me</p>
        <p class="literal hidden" id="wordLiteral"></p>
        <div class="actions pattern-actions panel-actions">
          <div class="pattern-control-col">
            <button id="nextWord" class="pattern-next-btn" aria-label="Next word">â†—</button>
            <p class="pattern-control-text">Next</p>
          </div>
          <div class="pattern-control-col">
            <button id="markKnown" class="pattern-mini-btn" aria-label="Mark word as known">âœ“</button>
            <p class="pattern-control-text">Known</p>
          </div>
          <div class="pattern-control-col">
            <button id="playWordAudio" class="play-icon-btn pattern-play-main" aria-label="Play word audio">â–¶</button>
            <p class="pattern-control-text">Play</p>
          </div>
          <div class="pattern-control-col">
            <button id="toggleWordJyutping" class="pattern-mini-btn pattern-toggle-btn is-off" aria-pressed="false" aria-label="Toggle Jyutping">ç²µ</button>
            <p class="pattern-control-text" id="wordJpText">Jyutping</p>
          </div>
          <div class="pattern-control-col">
            <button id="toggleWordEnglish" class="pattern-mini-btn pattern-toggle-btn is-off" aria-pressed="false" aria-label="Toggle English">EN</button>
            <p class="pattern-control-text">English</p>
          </div>
        </div>
        <div class="actions word-example-actions">
          <button id="revealExample">Show example</button>
        </div>
        <p class="example" id="wordExample"></p>
      </div>
      <div class="mini-stats">
        <p id="knownWords">Known words: 0</p>
        <p id="reviewedWords">Reviewed today: 0</p>
      </div>
      <div class="actions">
        <button id="toggleKnownList">Show known list</button>
      </div>
      <div class="card hidden" id="knownListWrap">
        <h3>Known Words</h3>
        <p class="example" id="knownListMeta">No words marked yet.</p>
        <div class="actions known-list-actions">
          <button id="clearKnownList" type="button">Clear all known</button>
        </div>
        <div class="known-list" id="knownList"></div>
      </div>
    </section>

    <section class="panel" id="panel-patterns">
      <div class="card">
        <h2>Build Sentences</h2>
        <p class="formula" id="patternFormula"></p>
        <div class="slot-grid" id="slotGrid"></div>
        <div class="result-box">
          <p class="hanzi" id="patternHanzi"></p>
          <p class="jyutping" id="patternJyutping"></p>
          <p class="english" id="patternEnglish"></p>
          <p class="literal" id="patternLiteral"></p>
          <div class="grammar-notes" id="patternGrammarNotes"></div>
        </div>
        <div class="actions pattern-actions">
          <div class="pattern-control-col">
            <button id="newPattern" class="pattern-next-btn" aria-label="Next pattern">â†—</button>
            <p class="pattern-control-text" id="patternNextText">Next</p>
          </div>
          <div class="pattern-control-col">
            <button id="toggleGrammarLens" class="pattern-mini-btn pattern-toggle-btn is-off" aria-pressed="false" aria-label="Toggle grammar lens">â—</button>
            <p class="pattern-control-text" id="patternLensText">Lens</p>
          </div>
          <div class="pattern-control-col">
            <button id="playPatternAudio" class="play-icon-btn pattern-play-main" aria-label="Play pattern sentence">â–¶</button>
            <p class="pattern-control-text">Play</p>
          </div>
          <div class="pattern-control-col">
            <button id="togglePatternJyutping" class="pattern-mini-btn pattern-toggle-btn is-off" aria-pressed="false" aria-label="Toggle Jyutping">ç²µ</button>
            <p class="pattern-control-text" id="patternJpText">Jyutping</p>
          </div>
          <div class="pattern-control-col">
            <button id="togglePatternEnglish" class="pattern-mini-btn pattern-toggle-btn is-off" aria-pressed="false" aria-label="Toggle English">EN</button>
            <p class="pattern-control-text" id="patternEnText">English</p>
          </div>
        </div>
      </div>
    </section>

    <section class="panel" id="panel-listening">
      <div class="card">
        <h2>Listen &amp; Choose</h2>
        <p>Tap play, listen, then choose the correct English meaning.</p>
        <p class="hanzi hidden" id="quizHanzi"></p>
        <p class="jyutping hidden" id="quizJyutping"></p>
        <p class="english hidden" id="quizEnglish"></p>
        <p class="literal" id="quizLiteral"></p>
        <div class="grammar-notes" id="quizGrammarNotes"></div>
        <div class="actions pattern-actions panel-actions">
          <div class="pattern-control-col">
            <button id="nextQuiz" class="pattern-next-btn" aria-label="Next quiz">â†—</button>
            <p class="pattern-control-text">Next</p>
          </div>
          <div class="pattern-control-col">
            <button id="toggleQuizGrammarLens" class="pattern-mini-btn pattern-toggle-btn is-off" aria-pressed="false" aria-label="Toggle grammar lens">â—</button>
            <p class="pattern-control-text">Lens</p>
          </div>
          <div class="pattern-control-col">
            <button id="playQuizAudio" class="play-icon-btn pattern-play-main" aria-label="Play listening clip">â–¶</button>
            <p class="pattern-control-text">Play</p>
          </div>
          <div class="pattern-control-col">
            <button id="showQuizText" class="pattern-mini-btn pattern-toggle-btn is-off" aria-pressed="false" aria-label="Toggle Hanzi">å­—</button>
            <p class="pattern-control-text">Hanzi</p>
          </div>
          <div class="pattern-control-col">
            <button id="toggleQuizJyutping" class="pattern-mini-btn pattern-toggle-btn is-off" aria-pressed="false" aria-label="Toggle Jyutping">ç²µ</button>
            <p class="pattern-control-text">Jyutping</p>
          </div>
          <div class="pattern-control-col hidden" id="quizEnglishControl">
            <button id="toggleQuizEnglish" class="pattern-mini-btn pattern-toggle-btn is-off" aria-pressed="false" aria-label="Toggle English">EN</button>
            <p class="pattern-control-text">English</p>
          </div>
        </div>
        <div class="choices" id="quizChoices"></div>
        <p class="feedback" id="quizFeedback"></p>
      </div>
    </section>

    <section class="panel" id="panel-questions">
      <div class="card">
        <h2>Ask &amp; Answer</h2>
        <p>Question-only training with natural English + literal structure. Use Practice Controls above for filters.</p>
        <p class="formula" id="questionFormula"></p>
        <div class="result-box">
          <p class="hanzi" id="questionHanzi"></p>
          <p class="jyutping" id="questionJyutping"></p>
          <p class="english" id="questionEnglish"></p>
          <p class="literal" id="questionLiteral"></p>
        </div>
        <div class="actions pattern-actions panel-actions">
          <div class="pattern-control-col">
            <button id="nextQuestion" class="pattern-next-btn" aria-label="Next question">â†—</button>
            <p class="pattern-control-text">Next</p>
          </div>
          <div class="pattern-control-col">
            <button id="toggleQuestionGrammarLens" class="pattern-mini-btn pattern-toggle-btn is-off" aria-pressed="false" aria-label="Toggle grammar lens">â—</button>
            <p class="pattern-control-text">Lens</p>
          </div>
          <div class="pattern-control-col">
            <button id="playQuestionAudio" class="play-icon-btn pattern-play-main" aria-label="Play question audio">â–¶</button>
            <p class="pattern-control-text">Play</p>
          </div>
          <div class="pattern-control-col">
            <button id="toggleQuestionJyutping" class="pattern-mini-btn pattern-toggle-btn is-off" aria-pressed="false" aria-label="Toggle Jyutping">ç²µ</button>
            <p class="pattern-control-text" id="questionJpText">Jyutping</p>
          </div>
          <div class="pattern-control-col">
            <button id="toggleQuestionEnglish" class="pattern-mini-btn pattern-toggle-btn is-off" aria-pressed="false" aria-label="Toggle English">EN</button>
            <p class="pattern-control-text">English</p>
          </div>
        </div>
      </div>
    </section>

    <section class="panel" id="panel-tones">
      <div class="card">
        <h2>Tone Drill</h2>
        <p>Press A, B, or Random. Then choose the Jyutping or sentence you just heard.</p>
        <p class="formula" id="toneLabel"></p>
        <p class="example" id="tonePrompt">Step 1: Play a clip. Step 2: Choose meaning below.</p>
        <div class="result-box">
          <p class="hanzi tone-line" id="toneHanzi"></p>
          <p class="jyutping tone-line" id="toneJyutping"></p>
          <p class="english tone-line" id="toneEnglish"></p>
        </div>
        <div class="actions pattern-actions panel-actions tone-actions">
          <div class="pattern-control-col">
            <button id="playToneA" class="play-icon-btn tone-play-btn" aria-label="Play tone A" data-tone-label="A">â–¶</button>
            <p class="pattern-control-text">Play A</p>
          </div>
          <div class="pattern-control-col">
            <button id="playToneB" class="play-icon-btn tone-play-btn" aria-label="Play tone B" data-tone-label="B">â–¶</button>
            <p class="pattern-control-text">Play B</p>
          </div>
          <div class="pattern-control-col">
            <button id="playToneRandom" class="play-icon-btn tone-play-btn" aria-label="Play random tone" data-tone-label="?">â–¶</button>
            <p class="pattern-control-text">Random</p>
          </div>
          <div class="pattern-control-col hidden" id="toneJyutpingControl">
            <button id="toggleToneJyutping" class="pattern-mini-btn pattern-toggle-btn is-off" aria-pressed="false" aria-label="Toggle Jyutping" disabled>ç²µ</button>
            <p class="pattern-control-text">Jyutping</p>
          </div>
          <div class="pattern-control-col">
            <button id="toggleToneEnglish" class="pattern-mini-btn pattern-toggle-btn is-off" aria-pressed="false" aria-label="Toggle English">EN</button>
            <p class="pattern-control-text">English</p>
          </div>
          <div class="pattern-control-col">
            <button id="nextTone" class="pattern-next-btn" aria-label="Next tone pair">â†—</button>
            <p class="pattern-control-text">Next</p>
          </div>
        </div>
        <div class="choices" id="toneChoices"></div>
        <p class="feedback" id="toneFeedback"></p>
        <p class="example" id="toneScore">Tone score: 0 / 0</p>
      </div>
    </section>

    <section class="panel" id="panel-exercises">
      <div class="card">
        <h2>Translate</h2>
        <p>Read the English line, then tap the Hanzi blocks to build the correct sentence.</p>
        <p class="formula" id="exercisePrompt"></p>
        <div class="result-box">
          <p class="hanzi" id="exerciseBuilt"></p>
          <div class="exercise-selected" id="exerciseSelected"></div>
        </div>
        <div class="exercise-bank" id="exerciseTokenBank"></div>
        <div class="actions pattern-actions panel-actions exercise-actions">
          <div class="pattern-control-col">
            <button id="clearExercise" class="pattern-mini-btn pattern-toggle-btn is-off" aria-label="Clear current exercise">â†º</button>
            <p class="pattern-control-text">Clear</p>
          </div>
          <div class="pattern-control-col">
            <button id="checkExercise" class="pattern-mini-btn pattern-toggle-btn is-on" aria-label="Check answer">âœ“</button>
            <p class="pattern-control-text">Check</p>
          </div>
          <div class="pattern-control-col">
            <button id="playExerciseAudio" class="play-icon-btn pattern-play-main" aria-label="Play exercise sentence">â–¶</button>
            <p class="pattern-control-text">Play</p>
          </div>
          <div class="pattern-control-col">
            <button id="nextExercise" class="pattern-next-btn" aria-label="Next exercise">â†—</button>
            <p class="pattern-control-text">Next</p>
          </div>
        </div>
        <p class="feedback" id="exerciseFeedback"></p>
      </div>
    </section>

    <section class="panel" id="panel-search">
      <div class="card">
        <h2>Search Dictionary</h2>
        <nav class="search-top-tabs" aria-label="Search types">
          <button class="tab search-nav-btn is-active" type="button" data-search-tab="standard">Standard</button>
          <button class="tab search-nav-btn" type="button" data-search-tab="slang">Slang</button>
        </nav>
        <p id="searchModeMeta" class="example">Standard Cantonese vocabulary search.</p>
        <p>Type English, Hanzi, Jyutping, or Pinyin.</p>
        <label for="searchInput">Search term</label>
        <div class="search-bar">
          <input id="searchInput" type="text" placeholder="e.g. tomorrow, è½æ—¥, ting1 jat6, æ˜å¤©" autocomplete="off">
          <button id="runSearch" type="button">Search</button>
        </div>
        <div class="actions">
          <button id="clearSearch" type="button">Clear</button>
        </div>
        <p id="searchHint" class="example">Try: tomorrow, now, I, where, half.</p>
        <div id="searchResults" class="search-results"></div>
      </div>
    </section>

    <section class="panel" id="panel-book">
      <div class="card stories-card">
        <h2>Book</h2>
        <p class="stories-intro">Reference area for grammar, tones, writing, and culture notes.</p>
        <section class="book-subpanel is-active" id="book-grammar">
          <p class="formula">Grammar Adventure</p>
          <div class="book-part-switch" role="group" aria-label="Grammar lessons">
            <button class="book-part-btn is-active" type="button" data-book-tab="grammar">Part 1</button>
            <button class="book-part-btn" type="button" data-book-tab="grammar2">Part 2</button>
          </div>
          <div class="book-lesson">
            <p class="book-lead"><strong>ä½ å¥½ï¼(NÃ©ih hÃ³u!)</strong></p>
            <p>Close your eyes for a second and picture this.</p>
            <p>You push open the glass door of a noisy Hong Kong yum cha restaurant. Warm steam hugs your face. Bamboo baskets clatter on trolleys, aunties shout <strong>é»å¿ƒåšŸå•¦ï¼</strong>, and the smell of fresh <strong>è¦é¤ƒ (haa1 gaau2)</strong> and <strong>å‰ç‡’åŒ… (caa1 siu1 baau1)</strong> makes your stomach happy. Everyone around you is laughing, pointing at plates, chatting non-stop.</p>
            <p>You sit down at the round table, heart beating a little fast, and you think:</p>
            <p class="book-quote">"I want to join them! I want to say 'This dumpling is delicious!' or 'I already ate three!' or 'More tea, please?' or even 'Tomorrow let's come again!'"</p>
            <p>And guess what? You can, because Cantonese grammar is built for exactly this kind of fun, everyday chat.</p>

            <p class="book-subtitle">1) Basic Word Order</p>
            <p>When you speak, the order is simple and friendly, just like English: <span class="book-chip">who + does what + what</span>.</p>
            <div class="book-example">
              <p><strong>æˆ‘é£ŸåŒ…ã€‚</strong> (Ngo5 sik6 baau1.) = I eat bun.</p>
              <p><strong>ä½ é£²èŒ¶ã€‚</strong> (Nei5 jam2 caa4.) = You drink tea.</p>
            </div>
            <p>Why so easy? No crazy word flipping, no "he eats" vs "I ate" changes. The verb stays the same every time.</p>

            <p class="book-subtitle">2) Tiny Magic Helpers</p>
            <p>To show when something happens, Cantonese adds tiny helpers:</p>
            <div class="book-example">
              <p><strong>é£Ÿå’— (sik6 zo2)</strong> = already eaten (finished action, like past).</p>
              <p><strong>æˆ‘é£Ÿå’—ä¸‰å€‹åŒ…ã€‚</strong> (Ngo5 sik6 zo2 saam1 go3 baau1.) = I ate three buns already.</p>
            </div>
            <div class="book-example">
              <p><strong>é£Ÿç·Š (sik6 gan2)</strong> = eating right now (action is happening).</p>
              <p><strong>æˆ‘é£Ÿç·Šå‰ç‡’åŒ…ï¼</strong> (Ngo5 sik6 gan2 caa1 siu1 baau1!) = I'm eating cha siu bao right now!</p>
            </div>
            <div class="book-example">
              <p><strong>è½æ—¥æœƒ (ting1 jat6 wui5)</strong> = will / tomorrow.</p>
              <p><strong>è½æ—¥æˆ‘æœƒå†åšŸã€‚</strong> (Ting1 jat6 ngo5 wui5 zoi3 lai4.) = Tomorrow I will come again.</p>
            </div>
            <p>Cantonese cares about how the action feels (done, happening, planned), so it sounds natural, like telling a story to friends.</p>

            <p class="book-subtitle">3) Tones = Meaning</p>
            <p>Those rising-falling sounds you hear everywhere are tones. Same letters, different melody, totally different meaning.</p>
            <div class="book-example">
              <p><strong>è©© (si1)</strong> = poem</p>
              <p><strong>è©¦ (si3)</strong> = try</p>
            </div>
            <p>That tone music is why we practise listening and speaking together in every drill.</p>

            <p class="book-subtitle">4) Easy Question Pattern</p>
            <p>Want to ask something? Just lift your voice or use a "not-yet?" pattern:</p>
            <div class="book-example">
              <p><strong>å¥½å””å¥½é£Ÿï¼Ÿ</strong> (Hou2 m4 hou2 sik6?) = Is it tasty? (good-not-good-eat?)</p>
              <p><strong>ä½ é£Ÿå’—æœªï¼Ÿ</strong> (Nei5 sik6 zo2 mei6?) = Have you eaten yet?</p>
            </div>

            <p class="book-subtitle">5) Final Particles + Counters</p>
            <p>Small words at the end add emotion and local flavor:</p>
            <div class="book-example">
              <p><strong>é£Ÿå•¦ï¼</strong> (Sik6 laa1!) = Eat already! / Come on, let's go!</p>
              <p><strong>å¥½å‘³å‘€ï¼</strong> (Hou2 mei6 aa3!) = So yummy!</p>
            </div>
            <p>And when counting, use a counter word:</p>
            <div class="book-example">
              <p><strong>ä¸€å€‹åŒ…</strong> (jat1 go3 baau1) = one bun.</p>
            </div>
            <p>Cantonese loves measure words. They make you sound polite and local right away.</p>

            <p>So here you are, sitting at the table, ready to speak your first real Cantonese sentences while the trolleys roll by. No scary textbooks, just real life, real food, real fun.</p>
            <p class="book-lead"><strong>ä½ å¾—ã—ï¼(NÃ©ih dÄk gaa!)</strong></p>
            <p class="example">Now open your eyes, take a deep breath, and tap Start the Adventure below. Let's eat, laugh, and talk like a local.</p>
          </div>
        </section>
        <section class="book-subpanel" id="book-grammar2">
          <p class="formula">Grammar 2</p>
          <div class="book-part-switch" role="group" aria-label="Grammar lessons">
            <button class="book-part-btn" type="button" data-book-tab="grammar">Part 1</button>
            <button class="book-part-btn is-active" type="button" data-book-tab="grammar2">Part 2</button>
          </div>
          <div class="book-lesson">
            <p class="book-lead"><strong>Real table talk: yum cha sentence building</strong></p>
            <p>Imagine you are at a noisy yum cha spot in the morning. Your friend just sat down, and you want to say:</p>
            <div class="book-example">
              <p><strong>æˆ‘è€Œå®¶åŒæœ‹å‹é£Ÿç·Šé»å¿ƒã€‚</strong></p>
              <p><strong>(Ngo5 ji4 gaa1 tung4 pang4 jau5 sik6 gan2 dim2 sam1.)</strong></p>
              <p><strong>Natural English:</strong> I am eating dim sum with my friend right now.</p>
            </div>

            <p class="book-subtitle">1) æˆ‘è€Œå®¶ (ngo5 ji4 gaa1) = I right now</p>
            <p>Cantonese often puts time words early. <strong>è€Œå®¶</strong> marks the action as happening now.</p>
            <div class="book-example">
              <p><strong>æˆ‘è€Œå®¶</strong> = I right now</p>
              <p>No extra am/is/are verb is needed.</p>
            </div>

            <p class="book-subtitle">2) åŒæœ‹å‹ (tung4 pang4 jau5) = with friend</p>
            <p><strong>åŒ</strong> is your with word. Put it before the person and keep the sentence simple.</p>
            <div class="book-example">
              <p>Pattern: <strong>åŒ + person</strong></p>
              <p><strong>åŒæœ‹å‹</strong> = with friend</p>
            </div>

            <p class="book-subtitle">3) é£Ÿç·Š (sik6 gan2) = eating (ongoing action)</p>
            <p>Add <strong>ç·Š</strong> after the verb to show in-progress action, similar to English -ing.</p>
            <div class="book-example">
              <p><strong>é£Ÿ</strong> = eat</p>
              <p><strong>é£Ÿç·Š</strong> = eating now</p>
              <p><strong>é£Ÿå’—</strong> = ate already (finished action)</p>
            </div>

            <p class="book-subtitle">4) é»å¿ƒ (dim2 sam1) = dim sum (general)</p>
            <p>Here, é»å¿ƒ is general food reference, so no measure word is required.</p>
            <div class="book-example">
              <p><strong>é£Ÿç·Šé»å¿ƒ</strong> = eating dim sum (general)</p>
              <p><strong>ä¸‰å€‹é»å¿ƒ</strong> = three pieces of dim sum (specific count)</p>
            </div>

            <p class="book-subtitle">Measure words quick cheat sheet</p>
            <div class="book-example">
              <p><strong>å€‹ (go3)</strong>: general classifier (ä¸€å€‹æœ‹å‹)</p>
              <p><strong>éš» (zek3)</strong>: animals/some object types (ä¸€éš»è²“)</p>
              <p><strong>æ¯ (bui1)</strong>: drinks (ä¸€æ¯å¥¶èŒ¶)</p>
              <p><strong>æ¢ (tiu4)</strong>: long things (ä¸€æ¢é­š)</p>
            </div>

            <p class="book-subtitle">Why this works so well</p>
            <p>Cantonese stacks logical sentence pieces and uses small helper markers instead of heavy verb changes.</p>
            <div class="book-example">
              <p><strong>æˆ‘ | è€Œå®¶ | åŒæœ‹å‹ | é£Ÿç·Š | é»å¿ƒ</strong></p>
              <p>I | right now | with friend | eating | dim sum</p>
            </div>
          </div>
        </section>
        <section class="book-subpanel" id="book-tones">
          <p class="formula">Tones</p>
          <div class="book-tone-switch" role="group" aria-label="Tones lessons">
            <button class="book-tone-btn is-active" type="button" data-book-tone-tab="tones">Tones</button>
            <button class="book-tone-btn" type="button" data-book-tone-tab="sounds">Sounds</button>
          </div>
          <div class="book-lesson book-tone-panel is-active" id="book-tone-tones">
            <p class="book-subtitle">Why tones are super important in Cantonese</p>
            <p>Cantonese has <strong>6 main tones</strong>. Some people say 9, but the extra 3 are short checked versions (for syllables ending in <strong>-p, -t, -k</strong>) that map to tones 1, 3, and 6. For beginners, focus on the main 6 first.</p>
            <p>Each tone is a different pitch pattern (how your voice moves up, down, or stays level).</p>
            <p><strong>Same sound + different tone = completely different word.</strong></p>

            <p class="book-subtitle">Example with "si"</p>
            <div class="book-example">
              <p><strong>si1</strong> = è©© = poem</p>
              <p><strong>si2</strong> = å² = history</p>
              <p><strong>si3</strong> = è©¦ = try / test</p>
              <p><strong>si4</strong> = æ™‚ = time</p>
              <p><strong>si5</strong> = å¸‚ = market / city</p>
              <p><strong>si6</strong> = äº‹ = thing / matter</p>
            </div>

            <p>Why? Over time, Cantonese lost many old final consonant differences, so tones carry more meaning. It is a bit like English stress, but much stronger.</p>

            <p class="book-subtitle">The 6 tones: quick voice picture</p>
            <div class="book-example">
              <p><strong>High level (si1)</strong>: flat and high, like a steady high note.</p>
              <p><strong>High rising (si2)</strong>: starts mid-high and rises, like a surprised "huh?".</p>
              <p><strong>Mid level (si3)</strong>: flat in the middle range, calm and neutral.</p>
              <p><strong>Low falling (si4)</strong>: starts low and falls, a heavier tone.</p>
              <p><strong>Low rising (si5)</strong>: starts low and rises gently.</p>
              <p><strong>Low level (si6)</strong>: flat and low, relaxed.</p>
            </div>

            <p class="book-subtitle">Examples you will hear often</p>
            <div class="book-example">
              <p><strong>å² si2</strong> = history</p>
              <p><strong>è©¦ si3</strong> = try</p>
              <p><strong>æ™‚ si4</strong> = time</p>
              <p><strong>å¸‚ si5</strong> = market</p>
              <p><strong>äº‹ si6</strong> = thing</p>
              <p><strong>åª½ maa1</strong> = mother</p>
            </div>

            <p>In <strong>Jyutping</strong>, the tone number at the end tells you the tone. This is why Jyutping is very useful for training.</p>

            <p class="book-subtitle">How to learn tones without stress</p>
            <div class="book-example">
              <p><strong>1) Listen a lot:</strong> repeat after native audio every day.</p>
              <p><strong>2) Practice minimal pairs:</strong> words that only differ by tone are gold.</p>
              <p><strong>è²· maai5</strong> (buy) vs <strong>è³£ maai6</strong> (sell).</p>
              <p><strong>3) Sing/hum tone paths:</strong> high flat -> rising -> mid flat -> low falling -> low rising -> low flat.</p>
              <p><strong>4) Record yourself:</strong> compare with native audio and adjust.</p>
            </div>

            <p>Tones are pronunciation, but they also act like grammar because they decide which word you are saying. If tones are strong early, sentence building becomes much easier.</p>
            <p class="book-lead"><strong>ä½ å¾—ã—ï¼Œæ…¢æ…¢ç·´å°±å¾—ï¼</strong> (You've got this. Practice slowly and it will click.)</p>
          </div>
          <div class="book-lesson book-tone-panel" id="book-tone-sounds">
            <p class="book-subtitle">Cantonese Sounds Guide (Jyutping)</p>
            <p>This is the Cantonese sounds guide using Jyutping (the easiest romanization for learners today).</p>
            <p>Jyutping shows you exactly how to say each word with numbers 1-6 for the tones.</p>
            <p>Why learn sounds first? Because one wrong sound can change the whole meaning, like saying "mother" instead of "horse". But don't worry, we practise slowly and with audio in real life.</p>

            <p class="book-subtitle">1) The Basic Consonants (starting sounds)</p>
            <p>Most are similar to English or Spanish, but a few are special:</p>
            <div class="book-example">
              <p><strong>b, d, g</strong>: soft, no puff of air (like Spanish "b" in "bebe", not strong English "b" in "bat").</p>
              <p>Ex: <strong>åŒ… baau1</strong> (bun) - gentle b.</p>
              <p><strong>p, t, k</strong>: strong puff of air when at the beginning (aspirated).</p>
              <p>Ex: <strong>æ€• paa3</strong> (afraid) - like "p" in "pin", not "spin".</p>
              <p><strong>j</strong>: like "y" in "yes" (not like English "j" in "jam").</p>
              <p>Ex: <strong>é­š jyu4</strong> (fish) = yoo.</p>
              <p><strong>z</strong>: like "j" in French "je" or soft "dz" (not English "z").</p>
              <p>Ex: <strong>å­— zi6</strong> (word/character) = like "jee" but short.</p>
              <p><strong>c</strong>: like "ts" in "cats" but strong puff.</p>
              <p>Ex: <strong>è»Š ce1</strong> (car/bus) = "ts" sound.</p>
              <p><strong>s</strong>: normal "s" like in "sun".</p>
              <p><strong>ng</strong>: like the end of "sing" but can start a word.</p>
              <p>Ex: <strong>æˆ‘ ngo5</strong> (I/me) - say "ng" first.</p>
              <p><strong>h</strong>: always strong breathy "h" like Spanish "j" in "jamon" but softer.</p>
              <p><strong>gw, kw</strong>: rounded lips like "gw" in "Gwen", "kw" in "queen".</p>
              <p>Ex: <strong>åœ‹ gwok3</strong> (country), å¿« <strong>faai3</strong> (fast) wait no - å¿« is faai3, but <strong>æ¡† kwong1</strong> (frame).</p>
            </div>

            <p class="book-subtitle">2) The Vowels (the singing part)</p>
            <p>Cantonese vowels are clear and usually short. Here are the main ones:</p>
            <div class="book-example">
              <p><strong>aa</strong>: long "a" like "father" but open mouth.</p>
              <p>Ex: <strong>åª½ maa1</strong> (mom).</p>
              <p><strong>a (short)</strong>: like "u" in "but" or "cup".</p>
              <p>Ex: <strong>å”” m4</strong> (not).</p>
              <p><strong>i</strong>: like "ee" in "see".</p>
              <p>Ex: <strong>é£Ÿ sik6</strong> (eat).</p>
              <p><strong>u</strong>: like "oo" in "food".</p>
              <p>Ex: <strong>æ›¸ syu1</strong> (book).</p>
              <p><strong>e</strong>: like "e" in "bed" but a bit higher.</p>
              <p>Ex: <strong>è»Š ce1</strong> (car).</p>
              <p><strong>o</strong>: like "aw" in "law" but shorter.</p>
              <p>Ex: <strong>å¥½ hou2</strong> (good).</p>
              <p><strong>oe</strong>: like French "eu" in "peur" or rounded "er".</p>
              <p>Ex: <strong>å¥³ neoi5</strong> (woman/girl) - lips rounded.</p>
              <p><strong>yu</strong>: like German "u" umlaut or French "u" in "lune".</p>
              <p>Ex: <strong>é­š jyu4</strong> (fish).</p>
              <p><strong>ei, ai, oi, ui, au, ou</strong> - diphthongs (two vowels gliding).</p>
              <p>Ex: <strong>ä½  nei5</strong> (you), <strong>è²· maai5</strong> (buy), <strong>æ„› oi3</strong> (love), <strong>æ¯ bui1</strong> (cup), <strong>å£ hau2</strong> (mouth), <strong>å¥½ hou2</strong> (good).</p>
            </div>

            <p class="book-subtitle">3) The 6 Tones - the music of Cantonese</p>
            <p>Tones are the most important part. They decide the meaning.</p>
            <p>Think of your voice like a little melody line:</p>
            <div class="book-example">
              <p><strong>High level (1)</strong> - flat and high, confident.</p>
              <p><strong>è©© si1</strong> = poem (like holding a high note steady)</p>
              <p><strong>High rising (2)</strong> - starts mid and goes up sharply.</p>
              <p><strong>å² si2</strong> = history</p>
              <p><strong>Mid level (3)</strong> - flat in the middle of your normal voice.</p>
              <p><strong>è©¦ si3</strong> = try / test</p>
              <p><strong>Low falling (4)</strong> - starts low and dips lower.</p>
              <p><strong>æ™‚ si4</strong> = time</p>
              <p><strong>Low rising (5)</strong> - starts low and rises gently.</p>
              <p><strong>å¸‚ si5</strong> = market / city</p>
              <p><strong>Low level (6)</strong> - flat and low, relaxed and casual.</p>
              <p><strong>äº‹ si6</strong> = thing / matter</p>
            </div>

            <p class="book-subtitle">Quick memory trick</p>
            <div class="book-example">
              <p>High -> Mid -> Low</p>
              <p>1 flat high -> 2 up high -> 3 flat mid</p>
              <p>4 down low -> 5 up low -> 6 flat low</p>
            </div>

            <p class="book-subtitle">Quick Practice Words (same sound, different tone)</p>
            <div class="book-example">
              <p><strong>è©© si1</strong> (poem)</p>
              <p><strong>å² si2</strong> (history)</p>
              <p><strong>è©¦ si3</strong> (try)</p>
              <p><strong>æ™‚ si4</strong> (time)</p>
              <p><strong>å¸‚ si5</strong> (market)</p>
              <p><strong>äº‹ si6</strong> (thing)</p>
              <p>Say them slowly, then faster.</p>
            </div>

            <p class="book-subtitle">Tips to Learn Fast</p>
            <div class="book-example">
              <p>Listen and repeat every day (audio apps or YouTube "Jyutping tones").</p>
              <p>Record yourself and compare.</p>
              <p>Start with tones 1, 3, 6 (easiest flats), then add 2 and 5 (risers).</p>
              <p>Sing the tones like a little song: high - up - mid - down - up - low.</p>
            </div>

            <p class="book-lead"><strong>You've got this. Once the sounds click, the rest (words, sentences) feels much easier.</strong></p>
          </div>
        </section>
        <section class="book-subpanel" id="book-writing">
          <p class="formula">Writing</p>
          <div class="book-lesson">
            <p class="book-subtitle">1) Main script: Traditional Chinese characters (ç¹é«”å­—)</p>
            <p>Cantonese in Hong Kong and Macau is written mainly with <strong>traditional characters</strong>, not simplified forms used in mainland China.</p>
            <p>Why? Hong Kong, Macau, and many overseas communities kept older full forms, so writing looks more detailed and classic.</p>
            <div class="book-example">
              <p><strong>Love:</strong> æ„› (traditional) vs çˆ± (simplified)</p>
              <p><strong>Eat:</strong> é£Ÿ (common Cantonese writing) vs åƒ (more Mandarin standard style, both understood)</p>
            </div>
            <p>Most characters overlap with standard written Chinese, so Cantonese speakers can read Mandarin text but pronounce it with Cantonese sounds and tones.</p>

            <p class="book-subtitle">2) Standard Chinese vs Colloquial Written Cantonese</p>
            <p><strong>Standard/Formal writing (æ›¸é¢èª):</strong> very close to written Mandarin. Used in books, school, news, and official writing.</p>
            <div class="book-example">
              <p><strong>æˆ‘å–œæ­¡ä½ </strong> = I like you (formal written form)</p>
              <p>Cantonese reading: <strong>ngo5 hei2 fun1 nei5</strong></p>
            </div>
            <p><strong>Colloquial written Cantonese (å£èªå¯«æ³•):</strong> used in chats, social media, subtitles, comics, and local ads.</p>
            <p>Why? Spoken Cantonese has words and particles not used in standard written Chinese, so writing adapts to real speech.</p>
            <div class="book-example">
              <p><strong>å””</strong> (m4, not) instead of ä¸</p>
              <p><strong>æˆ‘å””çŸ¥</strong> = I don't know</p>
              <p><strong>ä½¢</strong> (keoi5, he/she/it) instead of ä»–/å¥¹/å®ƒ</p>
              <p><strong>ä¹œå˜¢ / å’©</strong> (mat1 je5 / me1) = what</p>
              <p><strong>ä½ é£Ÿå’—ä¹œå˜¢ï¼Ÿ</strong> = What did you eat?</p>
              <p>Particles stay in writing: <strong>å¥½é£Ÿå‘€ï¼</strong></p>
              <p>Common Cantonese-only feeling words: <strong>å†‡</strong> (not have), <strong>åšŸ</strong> (come), <strong>ä¿‚</strong> (is)</p>
            </div>

            <p class="book-subtitle">3) Romanization: writing Cantonese sounds with Latin letters</p>
            <p>Characters do not directly show pronunciation, so learners use romanization systems.</p>
            <div class="book-example">
              <p><strong>Jyutping (ç²µæ‹¼)</strong>: modern standard, uses tone numbers 1-6.</p>
              <p>Example: æˆ‘é£Ÿé£¯ = <strong>ngo5 sik6 faan6</strong></p>
              <p>Why popular: accurate, keyboard friendly, common in apps and dictionaries.</p>
            </div>
            <div class="book-example">
              <p><strong>Yale</strong>: older learner system, often uses accents or h-marking (no final tone numbers).</p>
              <p>Example: æˆ‘é£Ÿé£¯ â‰ˆ <strong>ngÃ³h sihk faahn</strong></p>
              <p>Why some like it: looks more familiar to English readers at first.</p>
            </div>

            <p class="book-subtitle">Quick app tips</p>
            <div class="book-example">
              <p>Start with <strong>traditional characters + Jyutping + audio</strong>.</p>
              <p>Add a toggle like <strong>Show colloquial mode</strong> for real Hong Kong-style lines.</p>
              <p>Explain simply: formal writing is close to Mandarin; daily chat writing has extra Cantonese flavor.</p>
            </div>
            <p>This helps beginners see writing as: characters + sounds + context, not something scary.</p>
            <p class="book-lead"><strong>ä½ å¯«å¾—è¶Šä¾†è¶Šéšã—ï¼</strong> (Your writing keeps getting better.)</p>
          </div>
        </section>
        <section class="book-subpanel" id="book-culture">
          <p class="formula">Culture</p>
          <div class="book-lesson">
            <p class="book-subtitle">Quick History Background</p>
            <p>Hong Kong started as a fishing village and trading port. After the Opium Wars, Britain took control (Hong Kong Island in 1842, then Kowloon and the New Territories later). In 1997, it returned to China as a Special Administrative Region under "one country, two systems".</p>
            <p>Why interesting? This created a strong East-West fusion: British-era systems and English influence, together with deep Cantonese roots from southern China.</p>
            <div class="book-example">
              <p>In one day you can see double-decker buses, afternoon tea, and yum cha culture together.</p>
            </div>

            <p class="book-subtitle">Population and Areas</p>
            <p>Population in 2026 is around <strong>7.4-7.5 million</strong> (small variation by source). Hong Kong is compact (about 1,100 kmÂ²), so density is very high and people live vertically.</p>
            <div class="book-example">
              <p><strong>Hong Kong Island:</strong> Central business core, Peak views, finance and offices.</p>
              <p><strong>Kowloon:</strong> dense streets, markets, Temple Street, Mong Kok energy.</p>
              <p><strong>New Territories:</strong> villages, country parks, hills, and quieter districts.</p>
              <p><strong>Islands:</strong> over 260 islands, including Lantau (Big Buddha, Disney).</p>
            </div>
            <p>You can move from skyscrapers to hiking trails or beaches in under an hour.</p>

            <p class="book-subtitle">Cultural Highlights</p>
            <div class="book-example">
              <p><strong>Food:</strong> Dim sum, roast meats, congee, egg tarts, cha chaan teng classics.</p>
              <p><strong>Yum cha:</strong> social tea + food time; people chat for long sessions.</p>
              <p><strong>Street food:</strong> fish balls, egg waffles, milk tea (å¥¶èŒ¶ naai5 caa4).</p>
              <p><strong>Transport:</strong> left-side driving, iconic ferries, very high transit usage.</p>
              <p><strong>Octopus:</strong> card used for MTR, buses, shops, and many daily payments.</p>
            </div>

            <p class="book-subtitle">Cost of Living Snapshot</p>
            <p>Housing is one of the biggest cost pressures. Central areas can be very expensive, while transport and local meals can still be relatively affordable compared with rent.</p>
            <div class="book-example">
              <p>Small flat in central zones: often very high monthly rent.</p>
              <p>Street meal: often around HK$50-100 range.</p>
              <p>Typical MTR trip: often around HK$10-20 range.</p>
            </div>

            <p class="book-subtitle">Language and Local Style</p>
            <p>Cantonese in Hong Kong is expressive and full of particles and slang. English loanwords are common in everyday speech.</p>
            <div class="book-example">
              <p><strong>å·´å£«</strong> (baa1 si2) = bus</p>
              <p><strong>æ³¢å£«</strong> (bo1 si6) = boss</p>
              <p>Particles like <strong>å•¦</strong>, <strong>å‘€</strong>, <strong>å–</strong> add tone and emotion in conversation.</p>
            </div>

            <p class="book-subtitle">Festivals and City Feeling</p>
            <div class="book-example">
              <p>Lunar New Year fireworks, Dragon Boat races, Mid-Autumn lanterns, Cheung Chau Bun Festival.</p>
              <p>Temples next to luxury malls, global brands next to old local shops.</p>
            </div>
            <p>Hong Kong feels fast, resilient, food-focused, and proudly Cantonese while still globally connected.</p>
            <p class="book-lead"><strong>ä½ åšŸé¦™æ¸¯ä¸€å®šæœƒæ„›ä¸Šä½¢ã—ï¼</strong> (You will likely fall in love with Hong Kong when you visit.)</p>
          </div>
        </section>
      </div>
    </section>

    <section class="panel" id="panel-stories">
      <div class="card stories-card">
        <h2>Stories</h2>
        <p class="stories-intro">Story area with a focused sub-menu. We can expand each section with full read-along content.</p>
        <section class="stories-subpanel" id="stories-curiosities">
          <div class="story-day-head">
            <p class="formula" id="storyOfDayLabel">Story of the day</p>
            <button id="playStoryAudio" class="play-icon-btn" type="button" aria-label="Play story of the day">â–¶</button>
          </div>
          <p class="example" id="storyOfDayMeta">Loading daily story...</p>
          <div id="storyOfDayLines" class="story-lines"></div>
          <p class="example" id="storyTapHint">Tap any highlighted Hanzi to open quick explanation.</p>
        </section>
        <section class="stories-subpanel" id="stories-facts">
          <p class="formula">Fun Facts</p>
          <p>Some words share Hanzi with Mandarin but sound very different, so romanization comparison is useful for memory.</p>
          <p class="example">Use compare mode to spot Cantonese vs Mandarin pronunciation quickly.</p>
        </section>
        <section class="stories-subpanel is-active" id="stories-dialogs">
          <p class="formula">Mini Stories</p>
          <div class="mini-story-select-wrap">
            <select id="miniStorySelect" class="side-select mini-story-select">
              <option value="fox_rabbit_easy">Story 1 (Easy): Fox and Rabbit</option>
              <option value="wet_market_advanced">Story 2 (Advanced): Wet Market</option>
            </select>
          </div>
          <div class="actions pattern-actions panel-actions">
            <div class="pattern-control-col">
              <button id="playMiniStoryAudio" class="play-icon-btn pattern-play-main" aria-label="Play mini story audio">â–¶</button>
              <p class="pattern-control-text">Play/Pause</p>
            </div>
            <div class="pattern-control-col">
              <button id="toggleMiniStoryJyutping" class="pattern-mini-btn pattern-toggle-btn is-off" aria-pressed="false" aria-label="Toggle mini story Jyutping">ç²µ</button>
              <p class="pattern-control-text">Jyutping</p>
            </div>
            <div class="pattern-control-col">
              <button id="toggleMiniStoryEnglish" class="pattern-mini-btn pattern-toggle-btn is-off" aria-pressed="false" aria-label="Toggle mini story English">EN</button>
              <p class="pattern-control-text">English</p>
            </div>
            <div class="pattern-control-col">
              <button id="toggleMiniStoryLens" class="pattern-mini-btn pattern-toggle-btn is-on" aria-pressed="true" aria-label="Toggle mini story grammar lens">â—</button>
              <p class="pattern-control-text">Lens</p>
            </div>
          </div>
          <p class="example" id="miniStoryMeta">Select a story and tap Play.</p>
          <div id="miniStoryLines" class="story-lines"></div>
          <p class="example" id="miniStoryTapHint">Tap any highlighted Hanzi to open quick explanation.</p>
        </section>
        <section class="stories-subpanel" id="stories-culture">
          <p class="formula">Street Culture</p>
          <p>Transport, wet market, and cha chaan teng phrases should be grouped by real situations to improve recall.</p>
          <p class="example">Next upgrade: add HK location packs and one-tap drill playlists.</p>
        </section>
        <section class="stories-subpanel" id="stories-fun">
          <p class="formula">Fun Loop</p>
          <p>Open your daily mission, combo, boss challenge, and mistake-fix mode from here.</p>
          <div class="actions">
            <button class="tab fun-tab" id="openFunLoop" type="button">Fun Loop</button>
          </div>
        </section>
      </div>
    </section>

    <section class="panel" id="panel-settings">
      <div class="card">
        <h2>Content Manager</h2>
        <p>Your app uses built-in basic words now. Import your own JSON to match your exact PDF list.</p>
        <div class="actions">
          <label class="file-btn" for="importFile">Import JSON</label>
          <input id="importFile" type="file" accept="application/json">
          <button id="exportData">Export current JSON</button>
          <button id="resetData">Reset built-in words</button>
        </div>
        <details>
          <summary>Expected JSON format</summary>
          <pre>{
  "words": [
    {
      "id": "w1",
      "hanzi": "æˆ‘",
      "jyutping": "ngo5",
      "mandarin_hanzi": "æˆ‘",
      "pinyin": "wÇ’",
      "english": "I / me",
      "mandarin_english": "I / me",
      "intent_id": "pronoun_i",
      "category": "pronoun",
      "example": "æˆ‘å­¸å»£æ±è©±ã€‚"
    }
  ],
  "patterns": [...],
  "quiz": [...]
}</pre>
        </details>
        <p id="contentMessage"></p>
      </div>
    </section>
  </main>

  <nav id="bottomNav" class="bottom-nav hidden" aria-label="Basic navigation">
    <button id="openUserPanel" class="bottom-nav-btn utility-btn" type="button" aria-label="Open profile and login settings">
      <span class="bottom-nav-icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" role="img" focusable="false" aria-hidden="true">
          <circle cx="12" cy="8" r="3.2"></circle>
          <path d="M5.5 19.5c1.7-3 4-4.4 6.5-4.4s4.8 1.4 6.5 4.4"></path>
        </svg>
        <svg class="legacy-icon" viewBox="0 0 24 24" role="img" focusable="false" aria-hidden="true">
          <path d="M3 10.5 12 3l9 7.5"></path>
          <path d="M6 9.5V20h12V9.5"></path>
          <path d="M10 20v-5h4v5"></path>
        </svg>
      </span>
      <span class="bottom-nav-label">User</span>
    </button>
    <button class="bottom-nav-btn" type="button" data-bottom-tab="book" data-bottom-group="book" aria-label="Open book section">
      <span class="bottom-nav-icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" role="img" focusable="false" aria-hidden="true">
          <path d="M5 6.5h6.5v11H5z"></path>
          <path d="M12.5 6.5H19v11h-6.5"></path>
          <path d="M11.5 8H7.2"></path>
          <path d="M16.8 8h-3.6"></path>
        </svg>
        <svg class="legacy-icon" viewBox="0 0 24 24" role="img" focusable="false" aria-hidden="true">
          <path d="M9 18a2.8 2.8 0 1 1-2.8-2.8H9z"></path>
          <path d="M9 7v11"></path>
          <path d="M9 7 18 5v10"></path>
          <path d="M18 15.2a2.8 2.8 0 1 1-2.8-2.8H18z"></path>
        </svg>
      </span>
      <span class="bottom-nav-label">Book</span>
    </button>
    <button class="bottom-nav-btn is-active" type="button" data-bottom-tab="words" data-bottom-group="learn" aria-label="Open learning tabs">
      <span class="bottom-nav-icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" role="img" focusable="false" aria-hidden="true">
          <path d="M4 12c2.8 0 4.6-2 8-2s5.2 2 8 2"></path>
          <path d="M4 7c2.8 0 4.6-2 8-2s5.2 2 8 2"></path>
          <path d="M4 17c2.8 0 4.6-2 8-2s5.2 2 8 2"></path>
        </svg>
      </span>
      <span class="bottom-nav-label">Learn</span>
    </button>
    <button class="bottom-nav-btn" type="button" data-bottom-tab="stories" data-bottom-group="stories" aria-label="Open stories">
      <span class="bottom-nav-icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" role="img" focusable="false" aria-hidden="true">
          <path d="M5 5h14v14H5z"></path>
          <path d="M9 5v14"></path>
          <path d="M12 8h5"></path>
          <path d="M12 12h5"></path>
          <path d="M12 16h5"></path>
        </svg>
      </span>
      <span class="bottom-nav-label">Stories</span>
    </button>
    <button class="bottom-nav-btn" type="button" data-bottom-tab="search" data-bottom-group="search" aria-label="Open search dictionary">
      <span class="bottom-nav-icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" role="img" focusable="false" aria-hidden="true">
          <circle cx="11" cy="11" r="6"></circle>
          <path d="m16 16 4 4"></path>
        </svg>
      </span>
      <span class="bottom-nav-label">Search</span>
    </button>
  </nav>

  <div id="userPanel" class="side-panel hidden" aria-hidden="true">
    <button id="closeUserPanelBackdrop" class="side-panel-backdrop" type="button" aria-label="Close user panel"></button>
    <aside class="side-panel-drawer" role="dialog" aria-label="User panel">
      <div class="card-head">
        <h2>Your Space</h2>
        <button id="closeUserPanel" class="ghost-btn" type="button">âœ•</button>
      </div>
      <div class="side-profile-head">
        <div class="side-avatar-circle" aria-hidden="true">
          <svg viewBox="0 0 24 24" role="img" focusable="false" aria-hidden="true">
            <circle cx="12" cy="12" r="9"></circle>
            <circle cx="9" cy="10" r="1.1"></circle>
            <circle cx="15" cy="10" r="1.1"></circle>
            <path d="M8.5 14.2c1 .9 2.2 1.3 3.5 1.3s2.5-.4 3.5-1.3"></path>
          </svg>
        </div>
        <div class="side-name-block">
          <span class="side-k">User name</span>
          <strong class="side-v">Adria Salvado</strong>
        </div>
      </div>
      <div class="side-simple-list">
        <div class="side-kv">
          <span class="side-k">Email</span>
          <div class="side-inline">
            <strong id="userEmailValue" class="side-v">adria@coach.app</strong>
            <button id="changeEmailBtn" class="side-action-btn side-action-soft side-inline-btn" type="button">Change/Update</button>
          </div>
        </div>
        <div class="side-kv">
          <span class="side-k">Password</span>
          <div class="side-inline">
            <strong class="side-v">â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</strong>
            <button id="changePasswordBtn" class="side-action-btn side-action-soft side-inline-btn" type="button">Reset/Change</button>
          </div>
        </div>
        <div class="side-kv">
          <span class="side-k">Account type</span>
          <div class="side-inline">
            <strong class="side-v">Premium</strong>
            <button id="upgradeAccountBtn" class="side-action-btn side-inline-btn" type="button">Upgrade</button>
          </div>
        </div>
        <div class="side-kv">
          <span class="side-k">Language mode</span>
          <select id="userLanguageMode" class="side-select">
            <option value="cantonese">Cantonese</option>
            <option value="mandarin">Mandarin</option>
            <option value="compare">Cantonese + Mandarin</option>
          </select>
        </div>
      </div>
      <div class="side-actions-stack">
        <button id="openSettingsFromUser" class="side-action-btn" type="button">Settings</button>
        <button id="openAboutBtn" class="side-action-btn side-action-soft" type="button">About Us</button>
        <button id="openTermsBtn" class="side-action-btn side-action-soft" type="button">Terms of Use</button>
        <button id="logOutBtn" class="side-action-btn side-action-soft" type="button">Log Off</button>
        <button id="clearCacheBtn" class="side-action-btn side-action-soft" type="button">Clear Cache</button>
      </div>
      <p id="userPanelMsg" class="example side-msg"></p>
    </aside>
  </div>

  <div id="fxLayer" class="fx-layer" aria-hidden="true"></div>
  <script src="app.js"></script>
</body>
</html>
