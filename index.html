<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
  <title>Cantonese Coach</title>
  <meta name="theme-color" content="#112d4e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="CanCoach">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="bg-shape shape-a"></div>
  <div class="bg-shape shape-b"></div>

  <main class="app-shell">
    <header class="topbar">
      <div>
        <p class="eyebrow">Daily Cantonese <span class="version-tag">v19.2.18</span></p>
        <h1>Cantonese Coach</h1>
      </div>
      <div class="topbar-right">
        <div class="streak" id="streakBadge">üî• 0d</div>
        <button id="openSettings" class="gear-btn" type="button" aria-label="Open audio and display settings">‚â°</button>
      </div>
    </header>

    <nav class="tabs">
      <button class="tab is-active" data-tab="words">Words</button>
      <button class="tab" data-tab="patterns">Patterns</button>
      <button class="tab" data-tab="listening">Listening</button>
      <button class="tab" data-tab="questions">Questions</button>
      <button class="tab" data-tab="tones">Tones</button>
      <button class="tab" data-tab="settings">Content</button>
      <button class="tab fun-tab" id="openFunLoop" type="button">Fun Loop</button>
    </nav>

    <section class="card controls-card">
      <div class="card-head">
        <h2>Practice Controls</h2>
        <button id="toggleControlsCard" class="ghost-btn" type="button">Hide ‚ñ≤</button>
      </div>
      <div class="slot-grid controls-grid">
        <div id="globalLevelWrap" class="general-control">
          <label for="globalLevel">Level (general exercises)</label>
          <select id="globalLevel">
            <option value="1">Level 1 - short</option>
            <option value="2">Level 2 - medium</option>
            <option value="3">Level 3 - advanced</option>
            <option value="4">Level 4 - long/conditional</option>
            <option value="mixed">Mixed levels</option>
          </select>
        </div>
        <div id="globalTenseWrap" class="general-control">
          <label for="globalTense">Verb Time</label>
          <select id="globalTense">
            <option value="mixed">Mixed</option>
            <option value="present">Present</option>
            <option value="past">Past</option>
            <option value="future">Future</option>
            <option value="conditional">Conditional</option>
          </select>
        </div>
        <div id="wordFilterWrap" class="general-control hidden">
          <label for="wordFilter">Word Filter</label>
          <select id="wordFilter">
            <option value="mixed">Mixed (all words)</option>
            <option value="past_markers">Past markers only</option>
            <option value="future_markers">Future markers only</option>
            <option value="present_markers">Present markers only</option>
            <option value="conditional_markers">Conditional markers only</option>
            <option value="verbs">Verbs</option>
            <option value="nouns">Nouns</option>
            <option value="time">Time words</option>
            <option value="grammar">Grammar words</option>
            <option value="adjectives">Adjectives</option>
            <option value="adverbs">Adverbs</option>
            <option value="pronouns">Pronouns</option>
            <option value="places">Places</option>
            <option value="conjunctions">Conjunctions</option>
            <option value="prepositions">Prepositions</option>
            <option value="measure_words">Measure words</option>
            <option value="particles">Particles</option>
            <option value="aspect_markers">Aspect markers</option>
          </select>
        </div>
        <div id="globalThemeWrap" class="general-control">
          <label for="globalTheme">Theme</label>
          <select id="globalTheme">
            <option value="mixed">Mixed</option>
            <option value="home">Home/Family</option>
            <option value="friends">Friends</option>
            <option value="travel">Travel/Going out</option>
            <option value="daily">Daily routines</option>
            <option value="holiday">Holiday plans</option>
          </select>
        </div>
        <div id="questionLevelWrap" class="question-control hidden">
          <label for="questionLevel">Question Level</label>
          <select id="questionLevel">
            <option value="basic">Basic Questions</option>
            <option value="advanced">Advanced Questions</option>
          </select>
        </div>
        <div id="questionTenseWrap" class="question-control hidden">
          <label for="questionTense">Verb Time</label>
          <select id="questionTense">
            <option value="mixed">Mixed</option>
            <option value="present">Present</option>
            <option value="past">Past</option>
            <option value="future">Future</option>
            <option value="conditional">Conditional</option>
          </select>
        </div>
        <div id="questionThemeWrap" class="question-control hidden">
          <label for="questionTheme">Theme</label>
          <select id="questionTheme">
            <option value="mixed">Mixed</option>
            <option value="home">Home/Family</option>
            <option value="friends">Friends</option>
            <option value="travel">Travel/Going out</option>
            <option value="daily">Daily routines</option>
            <option value="holiday">Holiday plans</option>
          </select>
        </div>
        <div id="toneModeWrap" class="general-control hidden">
          <label for="toneExerciseMode">Tone Exercise</label>
          <select id="toneExerciseMode">
            <option value="word">Word pairs</option>
            <option value="sentence">Sentence pairs (L3+)</option>
          </select>
        </div>
      </div>
      <div class="actions">
        <button id="applyControls">Apply Settings</button>
      </div>
      <p class="example" id="controlsMessage"></p>
    </section>

    <div class="modal hidden" id="settingsModal">
      <div class="modal-card">
        <div class="card-head">
          <h2>Audio & Display</h2>
          <button id="closeSettings" class="ghost-btn" type="button">‚úï</button>
        </div>
        <div class="slot-grid">
          <div>
            <label for="audioVoice">Audio Voice</label>
            <select id="audioVoice">
              <option value="auto">Auto (best Cantonese)</option>
            </select>
          </div>
          <div>
            <label for="audioRate">Audio Speed (<span id="audioRateValue">0.90x</span>)</label>
            <input id="audioRate" type="range" min="0.6" max="1.2" step="0.05" value="0.9">
          </div>
          <div>
            <label for="themeStyle">Theme Style</label>
            <select id="themeStyle">
              <option value="classic">Classic Pastel</option>
              <option value="harbour">HK Harbour Pastel</option>
              <option value="neon">HK Neon Soft</option>
              <option value="neon-strong">HK Neon Strong</option>
              <option value="neon-extreme">HK Neon Extreme</option>
              <option value="ink">Ink Newspaper</option>
              <option value="poster">HK Poster Pop</option>
            </select>
          </div>
          <div>
            <label for="audioNoiseOn">Voice Noise (real-world practice)</label>
            <select id="audioNoiseOn">
              <option value="off">Off</option>
              <option value="on">On</option>
            </select>
          </div>
          <div>
            <label for="audioNoiseType">Noise Type</label>
            <select id="audioNoiseType">
              <option value="white">White noise</option>
              <option value="street">Street</option>
              <option value="radio">Radio</option>
              <option value="people">People talking</option>
              <option value="real-market">Real wet market (beta)</option>
              <option value="real-radio">Real radio chatter (beta)</option>
            </select>
          </div>
          <div>
            <label for="audioNoiseLevel">Noise Level (<span id="audioNoiseValue">0.25</span>)</label>
            <input id="audioNoiseLevel" type="range" min="0.05" max="0.80" step="0.01" value="0.25">
          </div>
        </div>
        <div class="actions">
          <button id="testVoice" class="play-icon-btn" aria-label="Test voice playback">‚ñ∂</button>
        </div>
      </div>
    </div>

    <div class="modal hidden" id="funModal">
      <div class="modal-card">
        <div class="card-head">
          <h2>Fun Loop</h2>
          <button id="closeFunLoop" class="ghost-btn" type="button">‚úï</button>
        </div>
        <p class="example">Daily mission (resets every day). XP = points. Combo = correct answers in a row. Mistakes = saved wrong items.</p>
        <div class="mini-stats">
          <p id="xpLine">XP: 0 ¬∑ Level 1</p>
          <p id="comboLine">Combo: x0</p>
          <p id="mistakeCount">Mistakes: 0</p>
        </div>
        <div class="mission-grid">
          <p id="missionListens">Listen: 0 / 10</p>
          <p id="missionTones">Tone wins: 0 / 5</p>
          <p id="missionPatterns">Sentence drills: 0 / 3</p>
          <p id="missionHanzi">Hanzi tests: 0 / 3</p>
        </div>
        <p class="goal-line" id="missionGoal">Goal today: complete all 4 targets, then pass Boss (4/5).</p>
        <div class="actions">
          <button id="toggleFixMode">Fix Mistakes: Off</button>
          <button id="startBoss">Start Boss Challenge</button>
        </div>
        <p class="feedback" id="funFeedback"></p>
        <div class="boss-wrap hidden" id="bossWrap">
          <p class="formula" id="bossProgress">Boss 1/5</p>
          <p id="bossPrompt"></p>
          <div class="choices" id="bossChoices"></div>
          <div class="actions">
            <button id="bossPlayAudio" class="play-icon-btn" aria-label="Play challenge audio">‚ñ∂</button>
            <button id="bossSkip">Skip</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal hidden" id="grammarModal">
      <div class="modal-card grammar-modal-card">
        <div class="card-head">
          <h2 id="grammarModalTitle">Grammar Info</h2>
          <button id="closeGrammarModal" class="ghost-btn" type="button">‚úï</button>
        </div>
        <div id="grammarModalBody" class="grammar-modal-body"></div>
      </div>
    </div>

    <section class="panel is-active" id="panel-words">
      <div class="card" id="wordCard">
        <p class="chip" id="wordCategory">Category</p>
        <h2 class="hanzi" id="wordHanzi">Êàë</h2>
        <p class="jyutping" id="wordJyutping">ngo5</p>
        <p class="english" id="wordEnglish">I / me</p>
        <p class="literal hidden" id="wordLiteral"></p>
        <div class="actions">
          <button id="playWordAudio" class="play-icon-btn" aria-label="Play word audio">‚ñ∂</button>
          <button id="revealExample">Show example</button>
          <div class="inline-pair">
            <button id="toggleWordJyutping">Hide Jyutping</button>
            <button id="toggleWordEnglish">Hide English</button>
          </div>
          <button id="markKnown">I know this</button>
          <button id="nextWord">Next</button>
        </div>
        <p class="example" id="wordExample"></p>
      </div>
      <div class="mini-stats">
        <p id="knownWords">Known words: 0</p>
        <p id="reviewedWords">Reviewed today: 0</p>
      </div>
      <div class="actions">
        <button id="toggleKnownList">Show known list</button>
      </div>
      <div class="card hidden" id="knownListWrap">
        <h3>Known Words</h3>
        <p class="example" id="knownListMeta">No words marked yet.</p>
        <div class="known-list" id="knownList"></div>
      </div>
    </section>

    <section class="panel" id="panel-patterns">
      <div class="card">
        <h2>Sentence Practice</h2>
        <p class="formula" id="patternFormula"></p>
        <div class="slot-grid" id="slotGrid"></div>
        <div class="result-box">
          <p class="hanzi" id="patternHanzi"></p>
          <p class="jyutping" id="patternJyutping"></p>
          <p class="english" id="patternEnglish"></p>
          <p class="literal" id="patternLiteral"></p>
          <div class="grammar-notes" id="patternGrammarNotes"></div>
        </div>
        <div class="actions">
          <button id="playPatternAudio" class="play-icon-btn" aria-label="Play pattern sentence">‚ñ∂</button>
          <button id="newPattern">Next pattern</button>
          <button id="toggleGrammarLens">Grammar Lens: Off</button>
          <div class="inline-pair">
            <button id="togglePatternJyutping">Hide Jyutping</button>
            <button id="togglePatternEnglish">Hide English</button>
          </div>
        </div>
      </div>
    </section>

    <section class="panel" id="panel-listening">
      <div class="card">
        <h2>Listening Quiz</h2>
        <p>Tap play, listen, then choose the correct English meaning.</p>
        <p class="hanzi hidden" id="quizHanzi"></p>
        <p class="jyutping hidden" id="quizJyutping"></p>
        <p class="english hidden" id="quizEnglish"></p>
        <p class="literal" id="quizLiteral"></p>
        <div class="grammar-notes" id="quizGrammarNotes"></div>
        <div class="actions">
          <button id="playQuizAudio" class="play-icon-btn" aria-label="Play listening clip">‚ñ∂</button>
          <button id="nextQuiz">Next quiz</button>
          <button id="toggleQuizGrammarLens">Grammar Lens: Off</button>
          <button id="showQuizText">Show Chinese</button>
          <div class="inline-pair">
            <button id="toggleQuizJyutping">Show/Hide Jyutping</button>
            <button id="toggleQuizEnglish">Show/Hide English</button>
          </div>
        </div>
        <div class="choices" id="quizChoices"></div>
        <p class="feedback" id="quizFeedback"></p>
      </div>
    </section>

    <section class="panel" id="panel-questions">
      <div class="card">
        <h2>Questions Practice</h2>
        <p>Question-only training with natural English + literal structure. Use Practice Controls above for filters.</p>
        <p class="formula" id="questionFormula"></p>
        <div class="result-box">
          <p class="hanzi" id="questionHanzi"></p>
          <p class="jyutping" id="questionJyutping"></p>
          <p class="english" id="questionEnglish"></p>
          <p class="literal" id="questionLiteral"></p>
        </div>
        <div class="actions">
          <button id="playQuestionAudio" class="play-icon-btn" aria-label="Play question audio">‚ñ∂</button>
          <button id="nextQuestion">Next question</button>
          <button id="toggleQuestionGrammarLens">Grammar Lens: Off</button>
          <div class="inline-pair">
            <button id="toggleQuestionJyutping">Hide Jyutping</button>
            <button id="toggleQuestionEnglish">Hide English</button>
          </div>
        </div>
      </div>
    </section>

    <section class="panel" id="panel-tones">
      <div class="card">
        <h2>Tone Contrast Drills</h2>
        <p>Press A, B, or Random. Then choose the Jyutping or sentence you just heard.</p>
        <p class="formula" id="toneLabel"></p>
        <p class="example" id="tonePrompt">Step 1: Play a clip. Step 2: Choose meaning below.</p>
        <div class="result-box">
          <p class="hanzi tone-line" id="toneHanzi"></p>
          <p class="jyutping tone-line" id="toneJyutping"></p>
          <p class="english tone-line" id="toneEnglish"></p>
        </div>
        <div class="actions">
          <button id="playToneA" class="play-icon-btn play-tone-btn" aria-label="Play tone A" data-tone-label="A">‚ñ∂</button>
          <button id="playToneB" class="play-icon-btn play-tone-btn" aria-label="Play tone B" data-tone-label="B">‚ñ∂</button>
          <button id="playToneRandom" class="play-icon-btn play-tone-btn" aria-label="Play random tone" data-tone-label="?">‚ñ∂</button>
          <div class="inline-pair">
            <button id="toggleToneJyutping">Hide Jyutping</button>
            <button id="toggleToneEnglish">Hide English</button>
          </div>
          <button id="nextTone">Next pair</button>
        </div>
        <div class="choices" id="toneChoices"></div>
        <p class="feedback" id="toneFeedback"></p>
        <p class="example" id="toneScore">Tone score: 0 / 0</p>
      </div>
    </section>

    <section class="panel" id="panel-settings">
      <div class="card">
        <h2>Content Manager</h2>
        <p>Your app uses built-in basic words now. Import your own JSON to match your exact PDF list.</p>
        <div class="actions">
          <label class="file-btn" for="importFile">Import JSON</label>
          <input id="importFile" type="file" accept="application/json">
          <button id="exportData">Export current JSON</button>
          <button id="resetData">Reset built-in words</button>
        </div>
        <details>
          <summary>Expected JSON format</summary>
          <pre>{
  "words": [
    {
      "id": "w1",
      "hanzi": "Êàë",
      "jyutping": "ngo5",
      "english": "I / me",
      "category": "pronoun",
      "example": "ÊàëÂ≠∏Âª£Êù±Ë©±„ÄÇ"
    }
  ],
  "patterns": [...],
  "quiz": [...]
}</pre>
        </details>
        <p id="contentMessage"></p>
      </div>
    </section>
  </main>

  <div id="fxLayer" class="fx-layer" aria-hidden="true"></div>
  <script src="app.js"></script>
</body>
</html>
